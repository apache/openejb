<?xml version="1.0" encoding="ISO-8859-1"?>

<!-- $Revision$ $Date$ -->

<project default="default"
  xmlns:j="jelly:core"
  xmlns:ant="jelly:ant"
  xmlns:maven="jelly:maven">

  <preGoal name="xdoc:jelly-transform">
    <attainGoal name="html2xdoc"/>
  </preGoal>

  <preGoal name="jar:jar">
    <ant:tstamp />
    <replace file="${maven.build.dest}/openejb-version.properties" 
             token="@VERSION-REPLACED-BY-MAVEN@"
             value="${pom.currentVersion}"/>
    <replace file="${maven.build.dest}/openejb-version.properties" 
             token="@DATE-REPLACED-BY-MAVEN@"
             value="${DSTAMP}"/>
    <replace file="${maven.build.dest}/openejb-version.properties" 
             token="@TIME-REPLACED-BY-MAVEN@"
             value="${TSTAMP}"/>
  </preGoal>

  <postGoal name="jar:jar">
    <ant:jar destfile="${basedir}/target/openejb-loader-${pom.currentVersion}.jar">
     <fileset dir="${basedir}/target/classes" >
             <include name="org/openejb/util/FileUtils.class" />
             <include name="org/openejb/client/LocalInitialContextFactory*" />
             <include name="org/openejb/loader/**" />
             <include name="org/openejb/OpenEJBException.class" />
     </fileset>
   </ant:jar>

    <copy file="${basedir}/../webadmin/src/webapp/WEB-INF/web.xml" todir="${basedir}/target"/>

    <war destfile="${basedir}/target/openejb-loader-${pom.currentVersion}.war" webxml="${basedir}/target/web.xml">
      <lib dir="${basedir}/target/">
        <include name="openejb-loader-${pom.currentVersion}.jar"/>
      </lib>
    </war>
   
    <delete file="${basedir}/target/web.xml"/>
  </postGoal>
</project>
