<?xml version="1.0"?>

<openejb-jar
    xmlns="http://www.openejb.org/xml/ns/openejb-jar-2.0"
    configId="openejb/itests/${openejb_version}/car"
    parentId="geronimo/default-database/${geronimo_version}/car"
    >

    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>${junit_version}</version>
    </dependency>

    <cmp-connection-factory>
        <application>null</application>
        <module>geronimo/default-database/${geronimo_version}/car</module>
        <name>DefaultDatasource</name>
    </cmp-connection-factory>

    <enterprise-beans>
        <!--
        ########################################################
        Stateless
        ########################################################
        -->
        <session>
            <ejb-name>BasicStatelessBean</ejb-name>
            <jndi-name>client/tests/stateless/BasicStatelessHome</jndi-name>
            <resource-ref>
                <ref-name>stateless/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>BasicBMTStatelessBean</ejb-name>
            <jndi-name>client/tests/stateless/BeanManagedBasicStatelessHome</jndi-name>
            <resource-ref>
                <ref-name>stateless/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>DatabaseBean</ejb-name>
            <jndi-name>client/tools/DatabaseHome</jndi-name>
            <resource-ref>
                <ref-name>database</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>BMTStatelessBean</ejb-name>
            <jndi-name>client/tests/stateless/BeanManagedTransactionTests/EJBHome</jndi-name>
            <resource-ref>
                <ref-name>database</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>EncStatelessBean</ejb-name>
            <jndi-name>client/tests/stateless/EncBean</jndi-name>
            <resource-ref>
                <ref-name>datasource</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>StatelessRMIIIOPBean</ejb-name>
            <jndi-name>client/tests/stateless/RMI-over-IIOP/EJBHome</jndi-name>
        </session>
        <session>
            <ejb-name>BasicStatelessBean</ejb-name>
            <jndi-name>client/tests/stateless/BasicStatelessHome</jndi-name>
            <resource-ref>
                <ref-name>stateless/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>SessionFacadeBean</ejb-name>
            <jndi-name>client/tests/entity/cmp/SessionFacadeBean</jndi-name>
        </session>

        <!--
        ########################################################
        Stateless
        ########################################################
        -->
        <session>
            <ejb-name>BasicStatefulBean</ejb-name>
            <jndi-name>client/tests/stateful/BasicStatefulHome</jndi-name>
            <resource-ref>
                <ref-name>stateful/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>BasicBMTStatefulBean</ejb-name>
            <jndi-name>client/tests/stateful/BeanManagedBasicStatefulHome</jndi-name>
            <resource-ref>
                <ref-name>stateful/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>BMTStatefulBean</ejb-name>
            <jndi-name>client/tests/stateful/BeanManagedTransactionTests/EJBHome</jndi-name>
            <resource-ref>
                <ref-name>datasource</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>EncStatefulBean</ejb-name>
            <jndi-name>client/tests/stateful/EncBean</jndi-name>
            <resource-ref>
                <ref-name>datasource</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </session>
        <session>
            <ejb-name>StatefulRMIIIOPBean</ejb-name>
            <jndi-name>client/tests/stateful/RMI-over-IIOP/EJBHome</jndi-name>
        </session>

        <!--
        ########################################################
        BMP
        ########################################################
        -->
        <entity>
            <ejb-name>BasicBmpBean</ejb-name>
            <jndi-name>client/tests/entity/bmp/BasicBmpHome</jndi-name>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </entity>
        <entity>
            <ejb-name>AOBasicBmpBean</ejb-name>
            <jndi-name>client/tests/entity/bmp/allowed_operations/EntityHome</jndi-name>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <resource-ref>
                <ref-name>entity/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </entity>
        <entity>
            <ejb-name>EncBmpBean</ejb-name>
            <jndi-name>client/tests/entity/bmp/EncBean</jndi-name>
            <resource-ref>
                <ref-name>datasource</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </entity>
        <entity>
            <ejb-name>BmpRMIIIOPBean</ejb-name>
            <jndi-name>client/tests/entity/bmp/RMI-over-IIOP/EJBHome</jndi-name>
        </entity>

        <!--
        ########################################################
        CMP 2
        ########################################################
        -->

        <entity>
            <ejb-name>BasicCmp2Bean</ejb-name>
            <jndi-name>client/tests/entity/cmp2/BasicCmpHome</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </entity>
        <entity>
            <ejb-name>AOBasicCmp2Bean</ejb-name>
            <jndi-name>client/tests/entity/cmp2/allowed_operations/EntityHome</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <resource-ref>
                <ref-name>entity/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </entity>
        <entity>
            <ejb-name>EncCmp2Bean</ejb-name>
            <jndi-name>client/tests/entity/cmp2/EncBean</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <resource-ref>
                <ref-name>datasource</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </entity>
        <entity>
            <ejb-name>Cmp2RMIIIOPBean</ejb-name>
            <jndi-name>client/tests/entity/cmp2/RMI-over-IIOP/EJBHome</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
        </entity>

        <!--
        ########################################################
        CMP
        ########################################################
        -->

        <entity>
            <ejb-name>BasicCmpBean</ejb-name>
            <jndi-name>client/tests/entity/cmp/BasicCmpHome</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <query>
                <query-method>
                    <method-name>findByLastName</method-name>
                    <method-params>
                        <method-param>java.lang.String</method-param>
                    </method-params>
                </query-method>
                <ejb-ql>
                <![CDATA[SELECT OBJECT(a) FROM BasicCmpBean AS a WHERE a.lastName = ?1]]>
                </ejb-ql>
            </query>
            <query>
                <query-method>
                    <method-name>findEmptyCollection</method-name>
                    <method-params/>
                </query-method>
                <ejb-ql>
                <![CDATA[SELECT OBJECT(a) FROM BasicCmpBean AS a WHERE 1 = 0]]>
                </ejb-ql>
            </query>
        </entity>
        <entity>
            <ejb-name>BasicCmpBeanExplicitPK</ejb-name>
            <table-name>entity_explicit_pk</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <query>
                <query-method>
                    <method-name>findByPrimaryKey</method-name>
                    <method-params>
                        <method-param>java.lang.Integer</method-param>
                    </method-params>
                </query-method>
                <ejb-ql>
                <![CDATA[SELECT OBJECT(a) FROM BasicCmpBeanExplicitPK AS a]]>
                </ejb-ql>
                <no-cache-flush/>
            </query>
            <query>
                <query-method>
                    <method-name>findByLastName</method-name>
                    <method-params>
                        <method-param>java.lang.String</method-param>
                    </method-params>
                </query-method>
                <ejb-ql>
                <![CDATA[SELECT OBJECT(a) FROM BasicCmpBeanExplicitPK AS a WHERE a.lastName = ?1]]>
                </ejb-ql>
            </query>
        </entity>
        <entity>
            <ejb-name>AOBasicCmpBean</ejb-name>
            <jndi-name>client/tests/entity/cmp/allowed_operations/EntityHome</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <resource-ref>
                <ref-name>entity/references/Resource_manager_access</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <query>
                <query-method>
                    <method-name>findByLastName</method-name>
                    <method-params>
                        <method-param>java.lang.String</method-param>
                    </method-params>
                </query-method>
                <ejb-ql>
                <![CDATA[SELECT OBJECT(a) FROM AOBasicCmpBean AS a WHERE a.lastName = ?1]]>
                </ejb-ql>
            </query>
            <query>
                <query-method>
                    <method-name>findEmptyCollection</method-name>
                    <method-params/>
                </query-method>
                <ejb-ql>
                <![CDATA[SELECT OBJECT(a) FROM AOBasicCmpBean AS a WHERE 1 = 0]]>
                </ejb-ql>
            </query>
        </entity>
        <entity>
            <ejb-name>EncCmpBean</ejb-name>
            <jndi-name>client/tests/entity/cmp/EncBean</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
            <resource-ref>
                <ref-name>jdbc/basic/entityDatabase</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
            <resource-ref>
                <ref-name>datasource</ref-name>
                <application>null</application>
                <module>geronimo/default-database/${geronimo_version}/car</module>
                <name>DefaultDatasource</name>
            </resource-ref>
        </entity>
        <entity>
            <ejb-name>CmpRMIIIOPBean</ejb-name>
            <jndi-name>client/tests/entity/cmp/RMI-over-IIOP/EJBHome</jndi-name>
            <table-name>entity</table-name>
            <cmp-field-mapping>
                <cmp-field-name>id</cmp-field-name>
                <table-column>id</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>firstName</cmp-field-name>
                <table-column>first_name</table-column>
            </cmp-field-mapping>
            <cmp-field-mapping>
                <cmp-field-name>lastName</cmp-field-name>
                <table-column>last_name</table-column>
            </cmp-field-mapping>
            <key-generator xmlns="http://www.openejb.org/xml/ns/pkgen-2.0">
                <custom-generator>
                    <generator-name>geronimo.server:role=CMPPKGenerator,name=Entity</generator-name>
                    <primary-key-class>java.lang.Integer</primary-key-class>
                </custom-generator>
            </key-generator>
        </entity>
    </enterprise-beans>

    <gbean gbeanName="geronimo.server:role=CMPPKGenerator,name=Entity" class="org.apache.openejb.entity.cmp.pkgenerator.AutoIncrementTablePrimaryKeyGeneratorWrapper">
        <reference name="ManagedConnectionFactoryWrapper"><gbean-name>*:J2EEApplication=null,JCAResource=geronimo/default-database/${geronimo_version}/car,j2eeType=JCAManagedConnectionFactory,name=DefaultDatasource,*</gbean-name></reference>
        <attribute name="sql">INSERT INTO entity (first_name) VALUES ('AUTO_GENERATED')</attribute>
        <attribute name="returnType">java.lang.Integer</attribute>
    </gbean>

</openejb-jar>
